<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Exclusive VIP Withdrawals</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <style type="text/tailwindcss">
        :root {
            --obsidian: #050505;
            --gold-primary: #D4AF37;
            --gold-secondary: #F9E29B;
            --gold-dark: #8A6D3B;
            --card-bg: #121212;
        }
        @layer base {
            body {
                font-family: 'Inter', sans-serif;
                background-color: var(--obsidian);
                color: #FFFFFF;
            }
        }
        .gold-gradient-text {
            background: linear-gradient(to bottom, var(--gold-secondary), var(--gold-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .gold-gradient-bg {
            background: linear-gradient(to bottom right, var(--gold-secondary), var(--gold-primary), var(--gold-dark));
        }
        .gold-border {
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        .gold-border-active {
            border: 2px solid var(--gold-primary);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">
    <header class="sticky top-0 z-20 bg-black/90 backdrop-blur-md border-b border-white/10 px-4 py-3">
        <div class="flex items-center justify-between">
            <a href="index.html"
                class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-white/5 transition-colors">
                <span class="material-symbols-outlined text-white">chevron_left</span>
            </a>
            <div class="flex flex-col items-center">
                <h1 class="text-sm font-bold flex items-center gap-1 gold-gradient-text tracking-tight uppercase">
                    VIP Exclusive Access
                    <span class="material-symbols-outlined text-[var(--gold-primary)] text-sm fill-1">verified</span>
                </h1>
            </div>
            <div class="flex gap-2 bg-white/5 p-1 rounded-full border border-white/10">
                <span class="material-symbols-outlined text-white/60 text-lg p-1">more_horiz</span>
            </div>
        </div>
        <div
            class="mt-4 flex items-center justify-between bg-[#111] p-3 rounded-2xl border border-[var(--gold-dark)]/30 shadow-2xl">
            <div class="flex items-center gap-3">
                <a href="profile.html" class="relative block">
                    <img id="user-avatar" alt="User Avatar"
                        class="w-10 h-10 rounded-full bg-slate-800 border border-[var(--gold-primary)]/40"
                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuBlNTq3R5GIojDDXC0bUXtM2lhjeyK6YXQ7y8HRQWJNOolI6YUoGWofuVldEgZ_jpZsCR3fvZ0X9aYdlJjQRnoEXJPZGfiMBbQbHy0qwsUOh4TzZAA9eDVf2Yt_hx6S5d2D53yK1oZPvH5kDRIYMRrsp1aRjvGiUFfGm2ajerzK0obaPPRvdOlvvNj2kYI5PSCgYIHDJRWJ2fQ4i41rwsnNo-QAtGr30hRluSoCAN4c9w-B78YX11R3pprjJD0Mtj2xQaF8ZDvkUgI" />
                    <div class="absolute -bottom-1 -right-1 bg-green-500 border-2 border-black w-3 h-3 rounded-full">
                    </div>
                </a>
                <div>
                    <h2 class="text-xs font-bold flex items-center gap-1"><span id="user-name">Crazy Developer BD</span>
                        <span class="material-symbols-outlined text-green-500 text-[10px] fill-1">check_circle</span>
                    </h2>
                    <p id="user-username" class="text-[9px] text-white/60 tracking-wider mb-0.5" style="display: none;">
                    </p>
                    <p id="user-id-display" class="text-[9px] text-white/40 tracking-wider">MEMBER ID: 5702521445</p>
                </div>
            </div>
            <div class="text-right">
                <div class="flex items-center justify-end gap-1">
                    <span class="material-symbols-outlined text-[var(--gold-primary)] text-sm">payments</span>
                    <span id="balance-display" class="text-sm font-bold text-white tracking-tight">3,223.20 BDT</span>
                </div>
                <div class="text-[9px] text-white/40 font-medium uppercase tracking-widest">Available Balance</div>
                <div class="flex items-center justify-end gap-1 mt-1">
                    <span class="material-symbols-outlined text-[var(--gold-primary)] text-[10px]">token</span>
                    <span id="tokens-display" class="text-[10px] font-bold text-white tracking-tight">0 <span
                            class="token-symbol-display">BTTC</span></span>
                </div>
            </div>
        </div>
    </header>
    <main class="flex-1 overflow-y-auto px-4 py-6 hide-scrollbar">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold gold-gradient-text italic">Exclusive Withdrawals</h2>
            <span
                class="bg-[var(--gold-primary)]/10 text-[var(--gold-primary)] text-[10px] px-2 py-1 rounded border border-[var(--gold-primary)]/20 font-bold">V-LEVEL
                5</span>
        </div>
        <div class="flex p-1 bg-white/5 border border-white/10 rounded-xl mb-8">
            <button
                class="flex-1 py-2.5 text-xs font-bold rounded-lg bg-[var(--gold-primary)] text-black transition-all">
                WITHDRAW BDT
            </button>
            <button
                class="flex-1 py-2.5 text-xs font-bold text-white/60 hover:text-white transition-all uppercase tracking-wide">
                WITHDRAW BTTC
            </button>
        </div>
        <section class="mb-8">
            <h3 class="text-[10px] font-bold text-white/40 mb-4 uppercase tracking-[0.2em]">Select Vault Destination
            </h3>
            <div class="grid grid-cols-2 gap-3">
                <div class="relative cursor-pointer group" onclick="selectPaymentMethod('bkash')">
                    <div id="method-bkash"
                        class="payment-method bg-[var(--card-bg)] gold-border rounded-2xl p-4 flex flex-col items-center gap-3 transition-all hover:bg-white/5">
                        <div
                            class="w-12 h-12 bg-pink-600 rounded-xl flex items-center justify-center overflow-hidden border border-white/10">
                            <img alt="bKash Logo" class="w-full h-full object-cover scale-150"
                                src="https://i.ibb.co.com/kgFrwxDK/bkash-logo-free-vector.jpg" />
                        </div>
                        <div class="text-center">
                            <span class="block font-bold text-xs text-white" id="text-bkash">bKash</span>
                            <span class="text-[9px] text-white/40">Min: <span class="min-withdraw-display">200
                                    BDT</span></span>
                        </div>
                    </div>
                </div>
                <div class="relative cursor-pointer" onclick="selectPaymentMethod('nagad')">
                    <div id="nagad-badge"
                        class="absolute -top-2 left-1/2 -translate-x-1/2 z-10 gold-gradient-bg text-[8px] font-black text-black px-3 py-0.5 rounded-full shadow-lg border border-black uppercase tracking-tighter">
                        VIP PREFERRED
                    </div>
                    <div id="method-nagad"
                        class="payment-method bg-[var(--card-bg)] gold-border-active rounded-2xl p-4 flex flex-col items-center gap-3 transition-all">
                        <div
                            class="w-12 h-12 bg-orange-600 rounded-xl flex items-center justify-center overflow-hidden border border-white/20">
                            <img alt="Nagad Logo" class="w-full h-full object-cover"
                                src="https://i.ibb.co.com/nshsXH9N/unnamed.png" />
                        </div>
                        <div class="text-center">
                            <span class="block font-bold text-xs text-[var(--gold-primary)]"
                                id="text-nagad">Nagad</span>
                            <span class="text-[9px] text-[var(--gold-secondary)] font-medium">Min:
                                <span class="min-withdraw-display">200 BDT</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="space-y-5">
            <div>
                <label id="account-label"
                    class="block text-[10px] font-bold text-white/40 mb-2 uppercase tracking-widest"
                    for="acc-number">Nagad Account Number</label>
                <div class="relative">
                    <span
                        class="absolute left-4 top-1/2 -translate-y-1/2 material-symbols-outlined text-[var(--gold-primary)] text-xl">account_balance_wallet</span>
                    <input
                        class="w-full bg-white/5 border-white/10 rounded-xl py-4 pl-12 pr-4 text-sm focus:ring-[var(--gold-primary)] focus:border-[var(--gold-primary)] text-white placeholder-white/20"
                        id="acc-number" placeholder="Enter your number" type="text" value="01700000000" />
                </div>
            </div>
            <div>
                <label class="block text-[10px] font-bold text-white/40 mb-2 uppercase tracking-widest"
                    for="amount">Payout Amount (BDT)</label>
                <div class="relative">
                    <span
                        class="absolute left-4 top-1/2 -translate-y-1/2 material-symbols-outlined text-[var(--gold-primary)] text-xl">token</span>
                    <input
                        class="w-full bg-white/5 border-white/10 rounded-xl py-4 pl-12 pr-4 text-sm focus:ring-[var(--gold-primary)] focus:border-[var(--gold-primary)] text-white placeholder-white/20"
                        id="amount" placeholder="Enter amount" type="number" />
                    <button
                        class="absolute right-4 top-1/2 -translate-y-1/2 text-[10px] font-black text-[var(--gold-primary)] bg-[var(--gold-primary)]/10 px-2 py-1 rounded">MAX</button>
                </div>
                <div class="flex justify-between items-center mt-2 px-1">
                    <p class="text-[9px] text-white/40 uppercase font-medium">Fee: 0.00 BDT</p>
                    <p class="text-[9px] text-white/40 uppercase font-medium tracking-tight">Min: <span
                            class="min-withdraw-display text-[var(--gold-secondary)]">200 BDT</span></p>
                </div>
            </div>
        </section>
        <div class="mt-10 mb-6">
            <button id="withdraw-btn" onclick="executeWithdrawal()"
                class="w-full py-4 gold-gradient-bg text-black font-black rounded-2xl shadow-[0_4px_20px_rgba(212,175,55,0.3)] transition-all active:scale-95 flex items-center justify-center gap-2 uppercase tracking-widest text-sm">
                Execute VIP Withdrawal
                <span class="material-symbols-outlined text-black font-black text-xl">lock_open</span>
            </button>
            <div id="withdraw-msg" class="hidden text-center text-xs font-bold mt-3 p-2 rounded-xl"></div>
            <div class="flex items-center justify-center gap-2 mt-4">
                <span class="material-symbols-outlined text-[var(--gold-primary)] text-[14px]">bolt</span>
                <p class="text-center text-[9px] text-white/50 uppercase tracking-[0.15em] font-medium">
                    VIP Tier Priority: Instant Processing Enabled
                </p>
            </div>
        </div>
    </main>
    <nav class="bg-black border-t border-white/10 px-6 py-2 pb-6 flex justify-between items-center">
        <a href="index.html" class="flex flex-col items-center gap-1 group">
            <span
                class="material-symbols-outlined text-white/40 group-hover:text-[var(--gold-primary)] transition-colors">grid_view</span>
            <span
                class="text-[9px] text-white/40 group-hover:text-[var(--gold-primary)] font-bold uppercase tracking-tighter">Home</span>
        </a>
        <a href="tasks.html" class="flex flex-col items-center gap-1 group">
            <span
                class="material-symbols-outlined text-white/40 group-hover:text-[var(--gold-primary)] transition-colors">ads_click</span>
            <span
                class="text-[9px] text-white/40 group-hover:text-[var(--gold-primary)] font-bold uppercase tracking-tighter">Earn</span>
        </a>
        <a href="wallet.html" class="flex flex-col items-center gap-1 group">
            <div class="bg-[var(--gold-primary)]/10 p-1.5 rounded-lg">
                <span class="material-symbols-outlined text-[var(--gold-primary)] fill-1">account_balance_wallet</span>
            </div>
            <span class="text-[9px] text-[var(--gold-primary)] font-black uppercase tracking-tighter">Vault</span>
        </a>
        <a href="referral.html" class="flex flex-col items-center gap-1 group">
            <span
                class="material-symbols-outlined text-white/40 group-hover:text-[var(--gold-primary)] transition-colors">military_tech</span>
            <span
                class="text-[9px] text-white/40 group-hover:text-[var(--gold-primary)] font-bold uppercase tracking-tighter">Refer</span>
        </a>
        <a href="profile.html" class="flex flex-col items-center gap-1 group text-slate-600">
            <span
                class="material-symbols-outlined text-white/40 group-hover:text-[var(--gold-primary)] transition-colors">account_circle</span>
            <span
                class="text-[9px] text-white/40 group-hover:text-[var(--gold-primary)] font-bold uppercase tracking-tighter">Profile</span>
        </a>
    </nav>
    <button
        class="fixed bottom-24 right-4 w-10 h-10 bg-[var(--gold-primary)] text-black rounded-full flex items-center justify-center shadow-xl z-50 transition-all active:scale-95"
        onclick="document.documentElement.classList.toggle('light')">
        <span class="material-symbols-outlined text-sm font-bold">diamond</span>
    </button>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        const tgUser = tg.initDataUnsafe.user || {
            id: '5702521445',
            first_name: 'Crazy Developer',
            last_name: 'BD',
            photo_url: 'https://lh3.googleusercontent.com/aida-public/AB6AXuBlNTq3R5GIojDDXC0bUXtM2lhjeyK6YXQ7y8HRQWJNOolI6YUoGWofuVldEgZ_jpZsCR3fvZ0X9aYdlJjQRnoEXJPZGfiMBbQbHy0qwsUOh4TzZAA9eDVf2Yt_hx6S5d2D53yK1oZPvH5kDRIYMRrsp1aRjvGiUFfGm2ajerzK0obaPPRvdOlvvNj2kYI5PSCgYIHDJRWJ2fQ4i41rwsnNo-QAtGr30hRluSoCAN4c9w-B78YX11R3pprjJD0Mtj2xQaF8ZDvkUgI'
        };

        const userId = tgUser.id.toString();
        const userRef = db.ref('users/' + userId);

        // Set initial UI from Telegram SDK
        document.getElementById('user-name').innerText = (tgUser.first_name + ' ' + (tgUser.last_name || '')).trim();
        if (tgUser.username) {
            document.getElementById('user-username').innerText = '@' + tgUser.username;
            document.getElementById('user-username').style.display = 'block';
        }
        document.getElementById('user-id-display').innerText = 'MEMBER ID: ' + userId;
        if (tgUser.photo_url) document.getElementById('user-avatar').src = tgUser.photo_url;

        let currentTokenSymbol = 'BTTC';
        let minWithdraw = 200;
        let userBalance = 0;
        let userName = 'User';

        db.ref('settings').on('value', (snap) => {
            const settings = snap.val() || {};
            if (settings.tokenName) {
                currentTokenSymbol = settings.tokenName;
                document.querySelectorAll('.token-symbol-display').forEach(el => el.innerText = currentTokenSymbol);
            }
            if (settings.minWithdraw !== undefined) {
                minWithdraw = settings.minWithdraw;
                document.querySelectorAll('.min-withdraw-display').forEach(el => el.innerText = minWithdraw + ' BDT');
            }
        });

        userRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                // Check if user is banned
                if (data.isBanned) {
                    document.body.innerHTML = `
                        <div class="min-h-screen bg-black flex items-center justify-center p-6 text-center">
                            <div class="premium-card p-10 border-red-500/30 bg-[#121212] rounded-3xl border border-white/5">
                                <span class="material-symbols-outlined text-red-500 text-6xl mb-4">block</span>
                                <h1 class="text-2xl font-black text-white mb-2 uppercase tracking-tight">Access Suspended</h1>
                                <p class="text-neutral-400 text-sm">Your account has been restricted by the administrator.</p>
                                <p class="text-neutral-500 text-[10px] mt-6 uppercase tracking-widest font-black">Secure Member Network</p>
                            </div>
                        </div>`;
                    return;
                }

                if (data.name) {
                    userName = data.name;
                    document.getElementById('user-name').innerText = userName;
                }
                if (data.username) {
                    document.getElementById('user-username').innerText = '@' + data.username;
                    document.getElementById('user-username').style.display = 'block';
                }
                if (data.photo_url) document.getElementById('user-avatar').src = data.photo_url;
                if (data.id) document.getElementById('user-id-display').innerText = 'MEMBER ID: ' + data.id;

                if (data.balance !== undefined) {
                    userBalance = data.balance;
                    document.getElementById('balance-display').innerText = userBalance.toLocaleString(undefined, { minimumFractionDigits: 2 }) + ' BDT';
                }
                if (data.tokens !== undefined) {
                    document.getElementById('tokens-display').innerHTML = `${(data.tokens || 0).toLocaleString()} <span class="token-symbol-display">${currentTokenSymbol}</span>`;
                }
            }
        });

        // Payment Method Logic
        let selectedMethod = 'nagad';

        function selectPaymentMethod(method) {
            selectedMethod = method;
            const bkashEl = document.getElementById('method-bkash');
            const nagadEl = document.getElementById('method-nagad');
            const lbl = document.getElementById('account-label');

            // Reset styles
            bkashEl.classList.remove('gold-border-active');
            bkashEl.classList.add('gold-border', 'hover:bg-white/5');
            document.getElementById('text-bkash').classList.remove('text-[var(--gold-primary)]');
            document.getElementById('text-bkash').classList.add('text-white');

            nagadEl.classList.remove('gold-border-active');
            nagadEl.classList.add('gold-border', 'hover:bg-white/5');
            document.getElementById('text-nagad').classList.remove('text-[var(--gold-primary)]');
            document.getElementById('text-nagad').classList.add('text-white');
            document.getElementById('subtext-nagad').classList.remove('text-[var(--gold-secondary)]');
            document.getElementById('subtext-nagad').classList.add('text-white/40');

            if (method === 'bkash') {
                bkashEl.classList.add('gold-border-active');
                bkashEl.classList.remove('gold-border', 'hover:bg-white/5');
                document.getElementById('text-bkash').classList.add('text-[var(--gold-primary)]');
                document.getElementById('text-bkash').classList.remove('text-white');
                lbl.innerText = 'bKash Account Number';
            } else if (method === 'nagad') {
                nagadEl.classList.add('gold-border-active');
                nagadEl.classList.remove('gold-border', 'hover:bg-white/5');
                document.getElementById('text-nagad').classList.add('text-[var(--gold-primary)]');
                document.getElementById('text-nagad').classList.remove('text-white');
                document.getElementById('subtext-nagad').classList.add('text-[var(--gold-secondary)]');
                document.getElementById('subtext-nagad').classList.remove('text-white/40');
                lbl.innerText = 'Nagad Account Number';
            }
        }

        function executeWithdrawal() {
            const accNum = document.getElementById('acc-number').value.trim();
            const amt = parseFloat(document.getElementById('amount').value);
            const msgEl = document.getElementById('withdraw-msg');
            msgEl.classList.remove('hidden', 'bg-green-500/10', 'text-green-500', 'bg-red-500/10', 'text-red-500');

            if (!accNum || accNum.length < 10) {
                msgEl.innerText = "Please enter a valid account number.";
                msgEl.classList.add('bg-red-500/10', 'text-red-500');
                msgEl.classList.remove('hidden');
                return;
            }
            if (isNaN(amt) || amt < minWithdraw) {
                msgEl.innerText = `Minimum payout is ${minWithdraw} BDT.`;
                msgEl.classList.add('bg-red-500/10', 'text-red-500');
                msgEl.classList.remove('hidden');
                return;
            }
            if (amt > userBalance) {
                msgEl.innerText = "Insufficient balance in your vault.";
                msgEl.classList.add('bg-red-500/10', 'text-red-500');
                msgEl.classList.remove('hidden');
                return;
            }

            const btn = document.getElementById('withdraw-btn');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = 'Submitting to Vault... <span class="material-symbols-outlined text-black animate-spin text-xl">autorenew</span>';
            btn.disabled = true;

            const withdrawalData = {
                userId: userId,
                userName: userName,
                amount: amt,
                method: selectedMethod.toUpperCase(),
                number: accNum,
                status: 'pending',
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // Process withdrawal
            const newRequestRef = db.ref('withdrawals').push();
            newRequestRef.set(withdrawalData).then(() => {
                // Deduct balance
                return userRef.update({
                    balance: firebase.database.ServerValue.increment(-amt)
                });
            }).then(() => {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
                msgEl.innerText = `Withdrawal request for ${amt} BDT submitted successfully!`;
                msgEl.classList.add('bg-green-500/10', 'text-green-500');
                msgEl.classList.remove('hidden');
                document.getElementById('amount').value = '';
                tg.HapticFeedback.notificationOccurred('success');
            }).catch(e => {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
                msgEl.innerText = "Error: " + e.message;
                msgEl.classList.add('bg-red-500/10', 'text-red-500');
                msgEl.classList.remove('hidden');
            });
        }
    </script>
</body>

</html>