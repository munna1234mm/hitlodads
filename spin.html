<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Elite Spin Wheel Simplified</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f2b90d",
                        "background-light": "#f8f8f5",
                        "background-dark": "#12110a",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        :root {
          --primary-gold: #f2b90d;
          --light-gold: #ffefba;
        }
        .gold-gradient {
            background: linear-gradient(135deg, #f2b90d 0%, #ffefba 50%, #f2b90d 100%);
        }
        .obsidian-glow {
            box-shadow: 0 0 40px rgba(242, 185, 13, 0.15);
        }
        .spin-wheel-outer-rim {
            border: 12px solid #f2b90d;
            box-shadow: 
                0 0 30px rgba(242, 185, 13, 0.5), 
                inset 0 0 15px rgba(0, 0, 0, 0.5),
                0 0 0 2px #d4a017;
        }
        .bulb {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, #fff 20%, #f2b90d 100%);
            border-radius: 50%;
            box-shadow: 0 0 8px #f2b90d, 0 0 12px #f2b90d;
            z-index: 40;
        }
        .wheel-conic {
            background: conic-gradient(
                #ef4444 0deg 45deg, 
                #3b82f6 45deg 90deg, 
                #22c55e 90deg 135deg, 
                #eab308 135deg 180deg, 
                #a855f7 180deg 225deg, 
                #f97316 225deg 270deg, 
                #06b6d4 270deg 315deg, 
                #ec4899 315deg 360deg
            );
            transition: transform 2s cubic-bezier(0.1, 0, 0.2, 1);
        }
        body {
          min-height: max(884px, 100dvh);
        }
    </style>
    <style>
        body {
            min-height: max(884px, 100dvh);
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen flex flex-col">
    <div
        class="flex items-center bg-background-light dark:bg-background-dark p-4 justify-between sticky top-0 z-50 border-b border-primary/10">
        <div class="text-slate-900 dark:text-slate-100 flex size-12 shrink-0 items-center justify-start">
            <a href="index.html" class="material-symbols-outlined cursor-pointer text-primary">arrow_back_ios</a>
        </div>
        <h2
            class="text-slate-900 dark:text-slate-100 text-lg font-bold leading-tight tracking-tight flex-1 text-center uppercase tracking-widest">
            VIP Lucky Spin</h2>
        <div class="flex w-12 items-center justify-end">
            <button class="flex items-center justify-center rounded-lg h-12 bg-transparent text-primary p-0">
                <span class="material-symbols-outlined">help_outline</span>
            </button>
        </div>
    </div>
    <main class="flex-1 overflow-y-auto relative px-4 py-8 flex flex-col items-center justify-between">
        <div class="absolute inset-0 pointer-events-none overflow-hidden opacity-30">
            <div class="absolute top-10 left-1/4 w-1 h-1 bg-primary rounded-full"></div>
            <div class="absolute top-40 right-1/3 w-2 h-2 bg-primary/60 rounded-full"></div>
            <div class="absolute bottom-60 left-10 w-1.5 h-1.5 bg-primary/40 rounded-full"></div>
            <div class="absolute top-1/2 right-10 w-1 h-1 bg-primary rounded-full"></div>
            <div class="absolute bottom-20 right-1/4 w-2 h-2 bg-primary/80 rounded-full"></div>
        </div>
        <div class="text-center mb-8 relative z-10">
            <h1
                class="text-3xl font-extrabold bg-gradient-to-r from-primary via-yellow-200 to-primary bg-clip-text text-transparent uppercase tracking-tight">
                Try Your Luck</h1>
            <p class="text-primary/70 text-sm mt-2 font-medium">Spin for premium VIP exclusive rewards</p>
        </div>
        <div class="relative w-72 h-72 @[480px]:w-80 @[480px]:h-80 mx-auto flex items-center justify-center mb-12">
            <div class="absolute inset-0 z-40 pointer-events-none">
                <div class="bulb" style="top: 2%; left: 50%; transform: translateX(-50%);"></div>
                <div class="bulb" style="top: 15%; left: 85%;"></div>
                <div class="bulb" style="top: 50%; left: 98%; transform: translateY(-50%);"></div>
                <div class="bulb" style="top: 85%; left: 85%;"></div>
                <div class="bulb" style="bottom: 2%; left: 50%; transform: translateX(-50%);"></div>
                <div class="bulb" style="top: 85%; left: 15%;"></div>
                <div class="bulb" style="top: 50%; left: 2%; transform: translateY(-50%);"></div>
                <div class="bulb" style="top: 15%; left: 15%;"></div>
            </div>
            <div class="absolute -top-6 left-1/2 -translate-x-1/2 z-50 drop-shadow-lg">
                <div class="w-10 h-12 gold-gradient" style="clip-path: polygon(0% 0%, 100% 0%, 50% 100%);"></div>
            </div>
            <div
                class="w-full h-full rounded-full spin-wheel-outer-rim relative overflow-hidden obsidian-glow flex items-center justify-center p-1 bg-[#1a180e]">
                <div id="wheel" class="absolute inset-0 rounded-full wheel-conic border-4 border-black/20"></div>
                <div class="absolute inset-0 opacity-20 pointer-events-none">
                    <div class="absolute h-full w-[1px] bg-black left-1/2 -translate-x-1/2"></div>
                    <div class="absolute w-full h-[1px] bg-black top-1/2 -translate-y-1/2"></div>
                    <div class="absolute h-full w-[1px] bg-black left-1/2 -translate-x-1/2 rotate-45"></div>
                    <div class="absolute h-full w-[1px] bg-black left-1/2 -translate-x-1/2 -rotate-45"></div>
                </div>
                <div
                    class="w-20 h-20 rounded-full gold-gradient shadow-[0_0_30px_rgba(0,0,0,0.5)] flex items-center justify-center z-30 border-4 border-[#1a180e]">
                    <span class="material-symbols-outlined text-background-dark font-black text-4xl"
                        style="font-variation-settings: 'FILL' 1">star</span>
                </div>
            </div>
        </div>
        <div class="w-full max-w-xs space-y-4 flex flex-col items-center">
            <button id="spin-btn" onclick="startSpin()"
                class="w-full py-5 rounded-xl gold-gradient text-background-dark font-extrabold text-xl shadow-[0_0_25px_rgba(242,185,13,0.3)] active:scale-95 transition-all duration-75 uppercase tracking-[0.1em]">
                Spin Now
            </button>
            <div class="flex gap-4 w-full">
                <div class="flex-1 bg-primary/5 border border-primary/20 rounded-xl p-3 obsidian-glow text-center">
                    <p class="text-[9px] text-primary/60 uppercase font-bold tracking-widest mb-0.5">Coins</p>
                    <p id="tokens-display" class="text-sm font-extrabold text-primary">0 <span
                            class="token-symbol-display">BTTC</span></p>
                </div>
                <div
                    class="flex-1 bg-[var(--gold-primary)]/10 border border-[var(--gold-primary)]/20 rounded-xl p-3 obsidian-glow text-center">
                    <p class="text-[9px] text-primary/60 uppercase font-bold tracking-widest mb-0.5">Spins Left</p>
                    <p id="spins-left-display" class="text-sm font-extrabold text-primary">-/-</p>
                </div>
            </div>
        </div>
    </main>
    <nav
        class="sticky bottom-0 w-full flex gap-2 border-t border-primary/10 bg-background-light dark:bg-background-dark px-4 pb-6 pt-2 z-50">
        <a class="flex flex-1 flex-col items-center justify-end gap-1 text-primary/60" href="index.html">
            <div class="flex h-8 items-center justify-center">
                <span class="material-symbols-outlined">home</span>
            </div>
            <p class="text-xs font-medium leading-normal">Home</p>
        </a>
        <a class="flex flex-1 flex-col items-center justify-end gap-1 text-primary" href="spin.html">
            <div class="flex h-8 items-center justify-center">
                <span class="material-symbols-outlined"
                    style="font-variation-settings: 'FILL' 1">progress_activity</span>
            </div>
            <p class="text-xs font-medium leading-normal">Spin</p>
        </a>
        <a class="flex flex-1 flex-col items-center justify-end gap-1 text-primary/60" href="wallet.html">
            <div class="flex h-8 items-center justify-center">
                <span class="material-symbols-outlined">account_balance_wallet</span>
            </div>
            <p class="text-xs font-medium leading-normal">Wallet</p>
        </a>
        <a class="flex flex-1 flex-col items-center justify-end gap-1 text-primary/60" href="profile.html">
            <div class="flex h-8 items-center justify-center">
                <span class="material-symbols-outlined">person</span>
            </div>
            <p class="text-xs font-medium leading-normal">Profile</p>
        </a>
    </nav>

    <!-- Custom Modal for Reward -->
    <div id="reward-modal"
        class="fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-6">
        <div
            class="bg-background-dark border border-primary/30 rounded-[2.5rem] p-10 w-full max-w-sm text-center relative overflow-hidden obsidian-glow">
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-primary/10 rounded-full blur-3xl"></div>
            <div class="relative z-10">
                <div
                    class="w-24 h-24 gold-gradient mx-auto rounded-full flex items-center justify-center mb-6 shadow-2xl">
                    <span
                        class="material-symbols-outlined text-background-dark text-5xl font-black">card_giftcard</span>
                </div>
                <h3 class="text-2xl font-black text-white mb-2 uppercase tracking-tight">Congratulations!</h3>
                <p class="text-primary/70 text-sm mb-8 font-medium">You received a lucky reward from the VIP Spin</p>

                <div class="bg-black/40 border border-primary/20 rounded-2xl py-6 mb-8 shadow-inner">
                    <p class="text-5xl font-black text-primary drop-shadow-[0_0_15px_rgba(242,185,13,0.5)]"
                        id="reward-amount-display">+50</p>
                    <p
                        class="text-[10px] text-white/50 font-black uppercase tracking-[0.2em] mt-2 token-symbol-display">
                        BTTC TOKENS</p>
                </div>

                <button onclick="closeModal()"
                    class="w-full py-4 rounded-xl gold-gradient text-background-dark font-extrabold uppercase tracking-widest text-sm shadow-xl active:scale-95 transition-all">
                    Claim Reward
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        const tg = window.Telegram.WebApp;
        const tgUser = tg.initDataUnsafe.user || {
            id: '5702521445',
            first_name: 'Crazy Developer',
            last_name: 'BD'
        };

        const userId = tgUser.id.toString();
        const userRef = db.ref('users/' + userId);
        const today = new Date().toISOString().split('T')[0];

        let currentTokenSymbol = 'BTTC';
        let currentSpinReward = 10;
        let isSpinning = false;
        let rotation = 0;
        let dailySpinLimit = 0;
        let todaySpinsUsed = 0;

        // Load Global Settings
        db.ref('settings').on('value', (snap) => {
            const settings = snap.val() || {};
            if (settings.tokenName) {
                currentTokenSymbol = settings.tokenName;
                document.querySelectorAll('.token-symbol-display').forEach(el => el.innerText = currentTokenSymbol);
            }
            if (settings.spinReward !== undefined) {
                currentSpinReward = settings.spinReward;
            }
            if (settings.dailySpinLimit !== undefined) {
                dailySpinLimit = settings.dailySpinLimit;
                updateSpinsDisplay();
            }
        });

        function updateSpinsDisplay() {
            document.getElementById('spins-left-display').innerText = `${Math.max(0, dailySpinLimit - todaySpinsUsed)}/${dailySpinLimit}`;
        }

        // Load User Data
        userRef.on('value', (snap) => {
            const data = snap.val();
            if (data) {
                document.getElementById('tokens-display').innerHTML = `${(data.tokens || 0).toLocaleString()} <span class="token-symbol-display">${currentTokenSymbol}</span>`;
                todaySpinsUsed = (data.dailyStats && data.dailyStats[today] && data.dailyStats[today].spinCount) || 0;
                updateSpinsDisplay();
            }
        });

        function startSpin() {
            if (isSpinning) return;

            if (todaySpinsUsed >= dailySpinLimit) {
                tg.showAlert("Daily limit reached! Please come back tomorrow.");
                return;
            }

            tg.HapticFeedback.impactOccurred('medium');
            isSpinning = true;
            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            btn.classList.add('opacity-50', 'pointer-events-none');

            // Generate a random rotation (at least 5 full turns + random angle)
            const extraRotation = 1800 + Math.floor(Math.random() * 360);
            rotation += extraRotation;

            const wheel = document.getElementById('wheel');
            wheel.style.transform = `rotate(${rotation}deg)`;

            // Wait 2 seconds for animation to complete
            setTimeout(() => {
                isSpinning = false;
                showReward();
                updateFirebase();
            }, 2000);
        }

        function showReward() {
            document.getElementById('reward-amount-display').innerText = `+${currentSpinReward}`;
            document.getElementById('reward-modal').classList.remove('hidden');
            tg.HapticFeedback.notificationOccurred('success');
        }

        function updateFirebase() {
            userRef.transaction((currentData) => {
                const newData = currentData || {
                    id: userId,
                    name: (tgUser.first_name + ' ' + (tgUser.last_name || '')).trim(),
                    username: tgUser.username || '',
                    photo_url: tgUser.photo_url || '',
                    tokens: 0,
                    balance: 0,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };

                // Add tokens
                newData.tokens = (newData.tokens || 0) + currentSpinReward;

                // Increment daily stats
                if (!newData.dailyStats) newData.dailyStats = {};
                if (!newData.dailyStats[today]) newData.dailyStats[today] = {};
                newData.dailyStats[today].spinCount = (newData.dailyStats[today].spinCount || 0) + 1;

                return newData;
            });
        }

        function closeModal() {
            document.getElementById('reward-modal').classList.add('hidden');
            const btn = document.getElementById('spin-btn');
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'pointer-events-none');
        }
    </script>
</body>

</html>